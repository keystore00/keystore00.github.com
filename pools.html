<html>
  <head>
    <title>Pool Stats - Monacoin keystore00</title>
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="./jquery.xdomainajax.js"></script>
    <script type="text/javascript">
      $.support.cors = true;
      // Load the Visualization API and the piechart package.
      google.load('visualization', '1.0', {'packages':['corechart']});
      // Set chart options
      var options = {'title':'Pool Hash Rate Pi Chart',
      'width':1000,
      'height':600};
      var column_options = {'title':'Pool Workers Column Chart',
      'width':900,
      'height':600};
      var chart;
      var column_chart
      var nethash = 0;
      var pool_total = 0;
      // Set a callback to run when the Google Visualization API is loaded.
      google.setOnLoadCallback(drawChart);

      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawChart() {

      var pools = { nichpool:'mona.2chpool.com', monapool:'mona1.monapool.com', gikopool:'gikopool.net', Kenmopool:'mona.pool.null-x.me', VIPPool:'vippool.net' };
      var num_pools = 0;
      for (var key in pools) {
      num_pools++;
      };

      // Create the data table.
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Pool');
      data.addColumn('number', 'Hashrate');
      var column_data = new google.visualization.DataTable();
      column_data.addColumn('string', 'Pool');
      column_data.addColumn('number', 'Workers');
      column_data.addColumn('number', 'Kh/s/worker');
      for (var key in pools) {
      $.ajax({
      url:"http://" + pools[key] + "/index.php?page=api&action=public",
      type:"GET",
      success: function(ret){
      var txt = ret["responseText"];
      var html = $.parseHTML(txt);
      var ptag = html[5];
      var json = $.parseJSON(ptag.innerHTML);
      data.addRow([json.pool_name + ": " + json.hashrate/1000 + " Mh/s",json.hashrate]);
      column_data.addRow([json.pool_name,json.workers,json.hashrate/json.workers]);
      if (data.getNumberOfRows() >= num_pools) {
      var pool_total = 0;
      var pool_total_workers = 0;
      for (var i = 0; i < data.getNumberOfRows(); i++) {
			  pool_total += data.getValue(i,1);
			  pool_total_workers += column_data.getValue(i,1);
			  }
			  $("#nethash").html(toMH(json.network_hashrate/1000));
			  $("#total_pool_hash").html(toMH(pool_total));
			  $("#total_workers").html(pool_total_workers);
			  $("#average_workers_hash").html(pool_total / pool_total_workers);
			  var others = json.network_hashrate/1000 - pool_total;
			  if (others > 0) {
	data.addRow(["Others " + others/1000 + " Mh/s",others]);
	};
	data.sort([{column: 1, desc:true}, {column: 0}]);
        chart.draw(data, options);
        column_data.sort([{column: 1, desc:true}, {column: 0}]);
        column_chart.draw(column_data, column_options);
	}
	},
	fail: function() {
	}
	});
	}


	// Instantiate and draw our chart, passing in some options.
	chart = new google.visualization.PieChart(document.getElementById('chart_div'));
	column_chart = new google.visualization.ColumnChart(document.getElementById('column_chart_div'));

	chart.draw(data, options);
	column_chart.draw(column_data, column_options);
	}
	function toMH(khash) {
	    return khash/1000 + " MH/s";
	}
    </script>
  </head>
  <body>
    <!--Div that will hold the pie chart-->
    <div align="center">
    <div id="chart_div"></div>
    <div id="column_chart_div"></div>
    <p>Estimated network hash rate: <span id="nethash">?</span>, Total pool hash rate<span id="total_pool_hash">?</span></p>
    <p>Total pool workers:<span id="total_workers">?</span>, Average pool workers hash rate:<span id="average_workers_hash">?</span> KH/s</p>
    <p>表示されている値は、参考程度とお考えください。</p>
    <p>リロードは控えてください。</p>
    <p>健全なネットワーク構築のためにプールのハッシュレートを分散させましょう。</p>
    <p>プールへのリンク↓。</p>
    <ul>
      <li><a href="http://gikopool.net">gikopool</a></li>
      <li><a href="http://mona.pool.null-x.me">Kenmopool</a></li>
      <li><a href="http://mona.2chpool.com">MONA 2ch pool</a></li>
      <li><a href="http://mona1.monapool.com">Monapool1</a></li>
      <li><a href="http://vippool.net">VIP Pool</a></li>
    </ul>
    </div>
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      try {
      var pageTracker = _gat._getTracker("UA-47602876-1");
      pageTracker._trackPageview();
      } catch(err) {}
    </script>
  </body>
</html>
